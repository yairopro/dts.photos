<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>WooDTS</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body style="margin: 0; display: flex; flex-direction: column;">

<script type="module">
	import products from "./src/products.js"
	window.products = products;
	products.forEach((gallery, id) => {
		gallery.forEach((image, index) => {
			image.src = `./res/image/product/${id}/${index}.${image.type}`;
		})
	})
</script>

<!--Logo-->
<img src="./res/image/logo.png" alt="woodts logo"
	 style="height: 150px; width: 150px; align-self: center; margin-top: 20px;">

<!--Gallery-->
<div id="gallery" style="margin-top: 40px;">
	<style>
		.item {
			width: 300px;
			margin-bottom: 10px;
			box-sizing: border-box;
			border-radius: 5px;
			cursor: pointer;
			overflow: hidden;
		}

		.item:hover {
			box-shadow: 0 0 10px black;
		}
	</style>

	<script type="module">
		import "https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"

		const COLUMN_WIDTH = 300;
		const GAP = 10;

		let gallery = document.getElementById("gallery");
		console.log(gallery);

		// --- center ---
		window.onresize = () => {
			let width = window.innerWidth;
			let columns = 0;
			let left, willLeft;
			do {
				left = willLeft;
				willLeft = width - ((columns * COLUMN_WIDTH) + ((columns - 1) * GAP));
				columns++;
			} while (willLeft > 0);
			gallery.style.marginLeft = `${left / 2}px`;
		};
		window.onresize(); // init

		let masonry = window.masonry = new Masonry( gallery, {
			columnWidth: COLUMN_WIDTH,
			itemSelector: '.item',
			gutter : GAP,
		});


		async function setImage(element, image){
			let img = new Image;
			img.src = image;
			await new Promise(resolve => img.onload = resolve);
			element.style.backgroundImage = `url("${image}")`;
		}

		products.forEach((productGallery, index) => {
			let item = document.createElement("div");
			item.classList.add("item");
			item.style.height = `${Math.trunc((productGallery[0].height / productGallery[0].width) * COLUMN_WIDTH)}px`;
			item.style.backgroundColor = productGallery[0].colors[0];

			let productView = document.createElement("div");
			productView.style.height = item.style.height;
			productView.style.backgroundSize = `cover`;
			item.appendChild(productView);
			setImage(productView, productGallery[0].src);

			gallery.appendChild(item);
			masonry.appended(item);

			item.onclick = () => openProduct(index);
		});
	</script>
</div>


<!--Product page-->
<div id="productPage" style="background: rgba(0,0,0,0.83)">
	<style>
		#productPage {
			position: fixed;
			top: 0; bottom: 0; right: 0;  left: 0;
			z-index: 1;
			display: none;
		}

		#productPage.open {
			display: block;
		}
	</style>
	<script>
		const productPage = document.getElementById("productPage");
		function openProduct(id){
			productPage.classList.add("open");
			const imageLayout = document.getElementById("productPageImage");
			imageLayout.style.backgroundImage = `url("${products[id][0].src}")`;
		}

		function closeProduct(){
			productPage.classList.remove("open");
		}
	</script>

	<!--app bar-->
	<div id="productPageAppBar" style="background: rgba(0,0,0,0.35); position: absolute; left: 0; top: 0; right: 0; z-index: 1;">
		<div
				onclick="closeProduct()"
				style="display: flex; align-items: center; justify-content: center; cursor: pointer; color: white; height: 64px; width: 64px; font-size: 17px; user-select: none;">
			<i class="material-icons">arrow_back</i>
		</div>

		<script>
			let productPageAppBar = document.getElementById("productPageAppBar");
			function toggleProductPageAppBar(){
				productPageAppBar.style.display = productPageAppBar.style.display === "none" ? "block" : "none";
			}
		</script>
	</div>

	<!--image-->
	<div id="productPageImage"
		 onclick="toggleProductPageAppBar()"
		 style="position: absolute; top: 0; bottom: 0; right: 0;  left: 0; background-size: contain; background-position:center; background-repeat: no-repeat;">

	</div>
</div>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>WooDTS</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body style="margin: 0; display: flex; flex-direction: column;">

<script type="module">
	import products from "./src/products.js"
	window.products = products;
	products.forEach((product) => {
		product.thumbnail.src = `./res/image/product/thumbnails/${product.thumbnail.file}`;
		product.gallery.forEach((image) => {
			image.src = `./res/image/product/galleries/${product.id}/${image.file}`;
		});
	});
</script>

<!--Logo-->
<img src="./res/image/logo.png" alt="woodts logo"
	 style="height: 150px; width: 150px; align-self: center; margin-top: 20px;">

<!--Gallery-->
<div id="gallery" style="margin-top: 40px;">
	<style>
		.item {
			width: 300px;
			margin-bottom: 10px;
			box-sizing: border-box;
			border-radius: 5px;
			cursor: pointer;
			overflow: hidden;
		}

		.item:hover {
			box-shadow: 0 0 10px black;
		}
	</style>

	<script type="module">
		import "https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"

		const COLUMN_WIDTH = 300;
		const GAP = 10;

		let gallery = document.getElementById("gallery");
		console.log(gallery);

		// --- center ---
		window.onresize = () => {
			let width = window.innerWidth;
			let columns = 0;
			let left, willLeft;
			do {
				left = willLeft;
				willLeft = width - ((columns * COLUMN_WIDTH) + ((columns - 1) * GAP));
				columns++;
			} while (willLeft > 0);
			gallery.style.marginLeft = `${left / 2}px`;
		};
		window.onresize(); // init

		let masonry = window.masonry = new Masonry( gallery, {
			columnWidth: COLUMN_WIDTH,
			itemSelector: '.item',
			gutter : GAP,
		});


		async function setImage(element, image){
			let img = new Image;
			img.src = image;
			await new Promise(resolve => img.onload = resolve);
			element.style.backgroundImage = `url("${image}")`;
		}

		products.forEach(product => {
			let item = document.createElement("div");
			item.classList.add("item");
			let image = product.thumbnail;
			item.style.height = `${Math.trunc((image.height / image.width) * COLUMN_WIDTH)}px`;
			item.style.backgroundColor = image.colors[0];

			let productView = document.createElement("div");
			productView.style.height = item.style.height;
			productView.style.backgroundSize = `cover`;
			item.appendChild(productView);
			setImage(productView, image.src);

			gallery.appendChild(item);
			masonry.appended(item);

			item.onclick = () => openProduct(product);
		});
	</script>
</div>


<!--Product page-->
<div id="productPage">
	<!-- Core CSS file -->
	<link rel="stylesheet" href="./src/photoSwipe/photoswipe.css">
	<link rel="stylesheet" href="./src/photoSwipe/default-skin/default-skin.css">
	<script src="./src/photoSwipe/photoswipe.js"></script>
	<script src="./src/photoSwipe/photoswipe-ui.js"></script>

	<script>
		function openProduct(product){
			let pswpElement = document.querySelector('.pswp');
			let gallery = new PhotoSwipe(
				pswpElement,
				PhotoSwipeUI_Default,
				product.gallery.map(({src, width, height}, index) => ({
					src,
					w: width,
					h: height,
					msrc: index ? null : product.thumbnail.src,
				})),
				{
					closeOnVerticalDrag: false,
					closeOnScroll: false,
					history: false,
					pinchToClose: false,
					loop: false,
				}
			);
			gallery.init();
		}
	</script>

	<!-- Root element of PhotoSwipe. Must have class pswp. -->
	<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

		<!-- Background of PhotoSwipe.
			 It's a separate element as animating opacity is faster than rgba(). -->
		<div class="pswp__bg"></div>

		<!-- Slides wrapper with overflow:hidden. -->
		<div class="pswp__scroll-wrap">

			<!-- Container that holds slides.
				PhotoSwipe keeps only 3 of them in the DOM to save memory.
				Don't modify these 3 pswp__item elements, data is added later on. -->
			<div class="pswp__container">
				<div class="pswp__item"></div>
				<div class="pswp__item"></div>
				<div class="pswp__item"></div>
			</div>

			<!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
			<div class="pswp__ui pswp__ui--hidden">

				<div class="pswp__top-bar">

					<!--  Controls are self-explanatory. Order can be changed. -->

					<div class="pswp__counter"></div>

					<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

					<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

					<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

					<!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
					<!-- element will get class pswp__preloader--active when preloader is running -->
					<div class="pswp__preloader">
						<div class="pswp__preloader__icn">
							<div class="pswp__preloader__cut">
								<div class="pswp__preloader__donut"></div>
							</div>
						</div>
					</div>
				</div>

				<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
					<div class="pswp__share-tooltip"></div>
				</div>

				<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
				</button>

				<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
				</button>

				<div class="pswp__caption">
					<div class="pswp__caption__center"></div>
				</div>

			</div>

		</div>

	</div>

</div>

</body>
</html>
